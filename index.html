<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Math Exam Editor v4.0.1 (Fixed)</title>
	    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <script src="js/config.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="module" src="js/main.js"></script>
</head>
<body>

<div id="loading-indicator">🔄 처리 중...</div>
<div id="toast-container"></div>
<div id="drop-overlay">📂 파일 놓기 (Import)</div>
<input type="file" id="imgUpload" accept="image/*" style="display:none;">
<input type="file" id="tocImageUpload" accept="image/*" style="display:none;">
<input type="file" id="tocOverlayImageUpload" accept="image/*" style="display:none;">

<div id="import-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>📥 AI 데이터 입력 (호환 모드)</span>
            <span class="modal-close" data-modal="import-modal" style="cursor:pointer;">×</span>
	        </div>
	        <textarea id="import-textarea" class="modal-textarea" placeholder="데이터를 여기에 붙여넣으세요..."></textarea>
	        <div style="font-size:11px; color:#666; line-height:1.4;">
	            블록박스 멀티라인은 `[블록박스_라벨]` 시작 후 `[/블록박스]`로 종료하세요.
	        </div>
            <div style="font-size:11px; color:#666; line-height:1.4; margin-top:6px;">
                <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
                    <input type="checkbox" id="setting-normalize-llm" checked>
                    LLM 출력 정규화(코드블록 제거, $$->$, \frac->\dfrac, ** 제거, 개념박스 번호화)
                </label>
            </div>
	        <div style="display:flex; justify-content:flex-end; gap:10px;">
	            <button class="btn btn-warning" data-action="confirm-import" data-overwrite="true" style="width:auto;">덮어쓰기</button>
	            <button class="btn btn-primary" data-action="confirm-import" data-overwrite="false" style="width:auto;">이어쓰기</button>
	            <button class="btn" data-action="close-modal" data-modal="import-modal" style="width:auto;">취소</button>
        </div>
    </div>
</div>

<div id="find-replace-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="font-weight:bold; font-size:16px;">🔍 일괄 바꾸기</div>
        <div class="fr-row"><span class="fr-label">찾을 내용</span><input type="text" id="fr-find-input" class="fr-input"></div>
        <div class="fr-row"><span class="fr-label">바꿀 내용</span><input type="text" id="fr-replace-input" class="fr-input"></div>
        <div class="fr-actions">
            <button class="btn btn-primary btn-sm" data-action="execute-find-replace">모두 바꾸기</button>
            <button class="btn btn-sm" data-action="close-modal" data-modal="find-replace-modal">닫기</button>
        </div>
    </div>
</div>

<div id="element-edit-modal" class="modal-overlay">
    <div class="modal-content" style="width:520px; gap:12px;">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span id="element-edit-title">요소 편집</span>
            <span class="modal-close" data-modal="element-edit-modal" style="cursor:pointer;">×</span>
        </div>
        <textarea id="element-edit-textarea" class="modal-textarea" placeholder="편집할 내용을 입력하세요..."></textarea>
        <div id="element-edit-hint" style="font-size:11px; color:#666; line-height:1.4;"></div>
        <div style="display:flex; justify-content:flex-end; gap:8px;">
            <button class="btn btn-primary btn-sm" data-action="apply-element-edit">적용</button>
            <button class="btn btn-sm" data-action="close-modal" data-modal="element-edit-modal">취소</button>
        </div>
    </div>
</div>

<div id="print-preflight-modal" class="modal-overlay">
    <div class="modal-content" style="width:420px; gap:12px;">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>🖨️ 인쇄 전 점검</span>
            <span class="modal-close" data-modal="print-preflight-modal" style="cursor:pointer;">×</span>
        </div>
        <div id="print-preflight-body" style="font-size:13px; line-height:1.6; color:#333;"></div>
        <div style="display:flex; justify-content:flex-end; gap:8px;">
            <button class="btn btn-purple btn-sm" data-action="print-preflight" data-mode="render">수식 변환 후 인쇄</button>
            <button class="btn btn-danger btn-sm" data-action="print-preflight" data-mode="print">그대로 인쇄</button>
            <button class="btn btn-sm" data-action="print-preflight" data-mode="cancel">취소</button>
        </div>
    </div>
</div>

<div id="confirm-modal" class="modal-overlay">
    <div class="modal-content" style="width:360px; gap:12px;">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>확인</span>
            <span class="modal-close" data-action="resolve-confirm" data-result="false" style="cursor:pointer;">×</span>
        </div>
        <div id="confirm-modal-message" style="font-size:13px; line-height:1.6; color:#333;"></div>
        <div style="display:flex; justify-content:flex-end; gap:8px;">
            <button class="btn btn-primary btn-sm" data-action="resolve-confirm" data-result="true">예</button>
            <button class="btn btn-sm" data-action="resolve-confirm" data-result="false">아니오</button>
        </div>
    </div>
</div>

<div id="patch-notes-modal" class="modal-overlay">
    <div class="modal-content" style="width:520px; gap:12px;">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>패치노트</span>
            <span class="modal-close" data-modal="patch-notes-modal" style="cursor:pointer;">×</span>
        </div>
        <div id="patch-notes-body" class="patch-notes-body">불러오는 중...</div>
        <div style="display:flex; justify-content:flex-end; gap:8px;">
            <button class="btn btn-sm" data-action="close-modal" data-modal="patch-notes-modal">닫기</button>
        </div>
    </div>
</div>

<div id="floating-toolbar">
    <div class="ft-row ft-row-style">
        <select id="ft-style-target" class="ft-select ft-select-wide" title="항목"></select>
        <select id="ft-font-family" class="ft-select" title="글씨체">
            <option value="default">기본</option>
            <option value="serif">명조</option>
            <option value="gothic">나눔고딕</option>
            <option value="gulim">굴림</option>
            <option value="noto-sans">Noto Sans KR</option>
            <option value="noto-serif">Noto Serif KR</option>
        </select>
        <input id="ft-font-size" class="ft-input" type="number" min="6" max="60" step="0.5" placeholder="pt" title="폰트 크기">
        <button class="ft-btn ft-toggle-btn" data-style="bold" title="굵게">B</button>
        <button class="ft-btn ft-toggle-btn ft-italic" data-style="italic" title="기울임">I</button>
        <button class="ft-btn ft-toggle-btn ft-underline" data-style="underline" title="밑줄">U</button>
        <div class="ft-color-group">
            <button class="ft-color-btn" data-style-color="#dc3545" style="--swatch:#dc3545" title="강조 빨강"></button>
            <button class="ft-color-btn" data-style-color="#007bff" style="--swatch:#007bff" title="강조 파랑"></button>
            <button class="ft-color-btn" data-style-color="#000000" style="--swatch:#000000" title="기본 검정"></button>
            <input id="ft-font-color" class="ft-color" type="color" title="글씨 색상">
        </div>
    </div>
    <div class="ft-row ft-row-actions">
        <button class="ft-btn" data-action="concept-blank" title="개념 빈칸">빈칸</button>
        <div class="ft-sep"></div>
        <button class="ft-btn" data-cmd="justifyLeft" title="왼쪽 정렬">⇤</button>
        <button class="ft-btn" data-cmd="justifyCenter" title="가운데 정렬">↔</button>
        <button class="ft-btn" data-cmd="justifyRight" title="오른쪽 정렬">⇥</button>
    </div>
</div>

<div id="image-resizer"><div class="resizer-handle rh-se"></div></div>

<div id="table-menu-handle" title="표 메뉴">▦</div>
<div id="table-menu">
    <div class="table-menu-title">표 편집</div>
    <div class="table-menu-section">
        <div class="table-menu-label">행/열</div>
        <div class="table-menu-row">
            <button class="table-menu-btn" data-action="add-row-above">+ 행 위</button>
            <button class="table-menu-btn" data-action="add-row-below">+ 행 아래</button>
            <button class="table-menu-btn" data-action="add-col-left">+ 열 왼</button>
            <button class="table-menu-btn" data-action="add-col-right">+ 열 오른</button>
        </div>
    </div>
    <div class="table-menu-section">
        <div class="table-menu-label">선 스타일</div>
        <div class="table-menu-row">
            <select id="table-border-style" class="table-menu-select">
                <option value="solid">실선</option>
                <option value="dashed">점선</option>
                <option value="transparent">투명</option>
            </select>
            <button class="table-menu-btn" data-action="border-all">전체</button>
            <button class="table-menu-btn" data-action="border-outer">외곽</button>
            <button class="table-menu-btn" data-action="border-inner">내부</button>
        </div>
        <div class="table-menu-row">
            <button class="table-menu-btn" data-action="border-top">위</button>
            <button class="table-menu-btn" data-action="border-right">오</button>
            <button class="table-menu-btn" data-action="border-bottom">아래</button>
            <button class="table-menu-btn" data-action="border-left">왼</button>
        </div>
        <div class="table-menu-hint">셀을 클릭한 뒤 적용하세요.</div>
    </div>
    <div class="table-menu-section">
        <div class="table-menu-label">간격 통일</div>
        <div class="table-menu-row">
            <button class="table-menu-btn" data-action="uniform-rows">행간격 통일</button>
            <button class="table-menu-btn" data-action="uniform-cols">열 간격 통일</button>
        </div>
        <div class="table-menu-hint">선택 셀 기준으로 적용됩니다.</div>
    </div>
    <div class="table-menu-section">
        <div class="table-menu-label">기타</div>
        <div class="table-menu-row">
            <button class="table-menu-btn" data-action="edit-table">편집</button>
            <button class="table-menu-btn" data-action="copy-table">복사</button>
            <button class="table-menu-btn menu-btn-danger" data-action="delete-table">삭제</button>
        </div>
    </div>
</div>

<div id="choice-menu-handle" title="선지 메뉴">선지</div>
<div id="choice-menu">
    <div class="choice-menu-title">선지 배치</div>
    <div class="choice-menu-row">
        <button class="choice-menu-btn" data-layout="1">1행</button>
        <button class="choice-menu-btn" data-layout="2">2행(3+2)</button>
        <button class="choice-menu-btn" data-layout="5">5행</button>
    </div>
    <div class="choice-menu-row choice-menu-actions">
        <button class="choice-menu-btn" data-action="edit-choice">편집</button>
        <button class="choice-menu-btn" data-action="copy-choice">복사</button>
        <button class="choice-menu-btn menu-btn-danger" data-action="delete-choice">삭제</button>
    </div>
</div>

<div id="math-menu">
    <div class="math-menu-row">
        <button class="math-menu-btn" data-action="edit">편집</button>
        <button class="math-menu-btn" data-action="blank">빈칸</button>
        <button class="math-menu-btn" data-action="unblank" disabled>빈칸 취소</button>
    </div>
    <div class="math-menu-row">
        <button class="math-menu-btn" data-action="copy">복사</button>
        <button class="math-menu-btn menu-btn-danger" data-action="delete">삭제</button>
    </div>
    <div class="math-menu-row">
        <button class="math-menu-btn" data-action="toggle-rendering">렌더링 해제</button>
    </div>
    <div class="math-menu-title">나누기 기준</div>
    <div class="math-menu-ops"></div>
</div>

<div id="element-menu">
    <div class="element-menu-title">요소 편집</div>
    <div class="element-menu-row">
        <button class="element-menu-btn" data-action="edit">편집</button>
        <button class="element-menu-btn" data-action="copy">복사</button>
        <button class="element-menu-btn menu-btn-danger" data-action="delete">삭제</button>
    </div>
    <div class="element-menu-row">
        <button class="element-menu-btn" data-action="unblank">빈칸 취소</button>
    </div>
    <div class="element-menu-row">
        <button class="element-menu-btn" data-action="toggle-rendering">렌더링 해제</button>
    </div>
</div>

<div id="context-menu">
    <div class="menu-title">블록 편집</div>
    <div class="menu-item" data-action="toggle-gray-bg"><span>🎨 회색 배경</span><span class="shortcut-badge">Ctrl+Alt+G</span></div>
    <div class="menu-item" data-action="toggle-border"><span>🔲 테두리 박스</span><span class="shortcut-badge">Ctrl+Alt+B</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" data-action="apply-align" data-align="left"><span>⇤ 왼쪽 정렬</span><span class="shortcut-badge">Ctrl+Sh+L</span></div>
    <div class="menu-item" data-action="apply-align" data-align="center"><span>↔ 가운데 정렬</span><span class="shortcut-badge">Ctrl+Sh+M</span></div>
    <div class="menu-item" data-action="apply-align" data-align="right"><span>⇥ 오른쪽 정렬</span><span class="shortcut-badge">Ctrl+Sh+R</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" data-action="duplicate-block"><span>📋 복제하기</span><span class="shortcut-badge">Ctrl+D</span></div>
    <div class="menu-item" data-action="add-block-above" data-type="example"><span>➕ 위에 추가</span><span class="shortcut-badge">Alt+Enter</span></div>
    <div class="menu-item" data-action="add-block-below" data-type="example"><span>➕ 아래에 추가</span><span class="shortcut-badge">Enter</span></div>
    <div class="menu-sep"></div>
    <div class="menu-title">컨셉 블록</div>
    <div class="menu-item" data-action="add-block-below" data-type="concept" data-variant="left-concept" data-label="Def."><span>➕ 좌컨셉 (Def.)</span><span class="shortcut-badge">-</span></div>
    <div class="menu-item" data-action="add-block-below" data-type="concept" data-variant="top-concept" data-label="Visual Concept"><span>➕ 상단컨셉</span><span class="shortcut-badge">-</span></div>
    <div class="menu-item" data-action="add-block-below" data-type="example" data-variant="two-col-concept"><span>➕ 2행컨셉</span><span class="shortcut-badge">-</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" data-action="insert-image-box"><span>🖼️ 이미지 삽입</span><span class="shortcut-badge">Ctrl+Alt+I</span></div>
    <div class="menu-item" data-action="insert-image-placeholder"><span>🖼️ 블록 안에 이미지 추가</span><span class="shortcut-badge">-</span></div>
	    <div class="menu-item" data-action="add-spacer"><span>↕ 여백 블록 추가</span><span class="shortcut-badge">Ctrl+Sh+Click</span></div>
	    <div class="menu-item" data-action="add-break"><span>⚡ 단 나누기 추가</span><span class="shortcut-badge">Ctrl+Alt+Click</span></div>
	    <div class="menu-sep"></div>
	    <div class="menu-title">폰트</div>
	    <div class="menu-item menu-font-row">
        <select id="block-font-family-select">
            <option value="default">기본</option>
            <option value="serif">명조</option>
            <option value="gulim">굴림</option>
            <option value="gothic">나눔고딕</option>
            <option value="noto-sans">Noto Sans KR</option>
            <option value="noto-serif">Noto Serif KR</option>
        </select>
	        <input type="number" id="block-font-size-input" min="8" max="20" step="0.5" style="width:60px;">
	        <button class="btn btn-sm" data-action="apply-block-font">적용</button>
	    </div>
	    <div class="menu-sep"></div>
	    <div class="menu-item" data-action="delete-block" style="color:#dc3545;"><span>🗑️ 삭제하기</span><span class="shortcut-badge">Delete</span></div>
</div>

<nav class="sidebar">
    <div class="sidebar-header" style="font-weight:bold; font-size:16px; margin-bottom:15px; border-bottom:2px solid #333; padding-bottom:5px;">
        📐 수학 에디터 v4.0
        <div style="font-size:10px; color:#666; font-weight:normal;">Modular Architecture (Fixed)</div>
    </div>

    <div class="sidebar-tree">
        <button class="btn" data-action="open-modal" data-modal="import-modal" style="margin-bottom:8px; border-left: 3px solid #6f42c1; color: #6f42c1; font-weight:bold;">📥 AI 데이터 입력 (Alt+I)</button>
        <button id="toggle-rendering-btn" class="btn" data-action="toggle-rendering" style="margin-bottom:8px;">🔓 렌더링 해제 (편집 모드)</button>
        <button id="toggle-page-controls-btn" class="btn" data-action="toggle-page-controls" style="margin-bottom:8px;">🧩 페이지 제어 숨김</button>
        <button class="btn btn-danger" data-action="print-with-math" style="margin-bottom:8px;">🖨️ 인쇄하기</button>
        <button class="btn" data-action="open-patch-notes" style="margin-bottom:8px;">📝 패치노트</button>

        <details class="sidebar-folder">
            <summary>파일</summary>
            <div class="sidebar-folder-body">
                <button class="btn btn-warning" data-action="reset-project">🗑️ 새로 만들기 (Alt+N)</button>
                <button class="btn btn-primary" data-action="save-project">💾 저장 (.msk / Ctrl+S)</button>
                <button class="btn" data-action="open-file-dialog">📂 열기 (.msk/.json / Ctrl+O)</button>
                <input type="file" id="fileInput" accept=".msk,.json" style="display:none">

                <div class="settings-panel" style="background:#e8f5e9; border:1px solid #c8e6c9; margin-top:10px;">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px;">📂 로컬 작업 폴더</div>
                    <div id="folder-status">⬇️ 저장: 다운로드</div>
                    <div class="settings-row"><label>이미지 폴더명</label><input type="text" id="setting-img-folder" value="images" style="width:80px;"></div>
                    <button class="btn btn-success" data-action="open-project-folder">📂 작업 폴더 열기</button>
                </div>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>프롬프트 다운로드</summary>
            <div class="sidebar-folder-body">
                <div class="sidebar-hint workflow-hint">
                    <div class="workflow-title">워크플로우</div>
                    <div class="workflow-step"><span class="workflow-badge">1단계</span><span>1번, 3번, 원본 PDF</span></div>
                    <div class="workflow-step"><span class="workflow-badge">2단계</span><span>2번, 3번, 4번, 1차 데이터추출 결과</span></div>
                </div>
                <button class="btn prompt-download" data-action="download-prompt" data-prompt-index="1" data-prompt-path="LLMprompt/4.0 프롬프트 - 1차 데이터추출.txt" data-prompt-name="4.0 프롬프트 - 1차 데이터추출 다운로드" data-prompt-date="2025-12-28">
                    1. ⬇️ 4.0 프롬프트 - 1차 데이터추출 다운로드 <span class="prompt-date">(2025-12-28)</span>
                </button>
                <button class="btn prompt-download" data-action="download-prompt" data-prompt-index="2" data-prompt-path="LLMprompt/4.0 프롬프트 - 2차 변환.txt" data-prompt-name="4.0 프롬프트 - 2차 변환 다운로드" data-prompt-date="2025-12-28">
                    2. ⬇️ 4.0 프롬프트 - 2차 변환 다운로드 <span class="prompt-date">(2025-12-28)</span>
                </button>
                <button class="btn prompt-download" data-action="download-prompt" data-prompt-index="3" data-prompt-path="LLMprompt/4.0 수악중독 콘텐츠 정의.txt" data-prompt-name="4.0 수악중독 콘텐츠 정의 다운로드" data-prompt-date="2025-12-28">
                    3. ⬇️ 4.0 수악중독 콘텐츠 정의 다운로드 <span class="prompt-date">(2025-12-28)</span>
                </button>
                <button class="btn prompt-download" data-action="download-prompt" data-prompt-index="4" data-prompt-path="LLMprompt/4.0 수악중독 골든 샘플 (경량).txt" data-prompt-name="4.0 수악중독 골든 샘플 다운로드" data-prompt-date="2025-12-27">
                    4. ⬇️ 4.0 수악중독 골든 샘플 다운로드 <span class="prompt-date">(2025-12-27)</span>
                </button>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>편집</summary>
            <div class="sidebar-folder-body">
                <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                    <button class="btn" style="width:48%" data-action="undo" title="실행 취소">↶ Undo<br><span style="font-size:9px;">(Ctrl+Z)</span></button>
                    <button class="btn" style="width:48%" data-action="redo" title="다시 실행">↷ Redo<br><span style="font-size:9px;">(Ctrl+Shift+Z)</span></button>
                </div>
                <button class="btn" data-action="open-modal" data-modal="find-replace-modal" data-focus="fr-find-input">🔍 찾기/바꾸기 (Ctrl+Shift+F)</button>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>서식</summary>
            <div class="sidebar-folder-body">
                <div class="settings-panel">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">🔤 기본 폰트</div>
                    <div class="settings-row"><label>폰트</label>
                        <select id="setting-font-family">
                            <option value="serif">기본(명조)</option>
                            <option value="gulim">굴림체</option>
                            <option value="gothic">나눔고딕</option>
                            <option value="noto-sans">Noto Sans KR</option>
                            <option value="noto-serif">Noto Serif KR</option>
                        </select>
                    </div>
                    <div class="settings-row"><label>크기(pt)</label><input type="number" id="setting-font-size" min="8" max="20" step="0.5"></div>
                </div>

                <div class="settings-panel">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">⚙️ AI 입력 설정</div>
                    <div class="settings-row"><label>단별 문제 수</label><input type="number" id="setting-limit" value="0"></div>
                    <div class="settings-row"><label>자동 여백</label><input type="checkbox" id="setting-spacer"></div>
                </div>

                <div class="settings-panel">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">📄 기본 단 구성</div>
                    <div class="settings-row"><label>기본 단 구성</label>
                        <select id="setting-columns">
                            <option value="2">2단</option>
                            <option value="1">1단</option>
                        </select>
                    </div>
                </div>

                <div class="settings-panel" style="margin-bottom:10px;">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">🏷️ 라벨 서식</div>
                    <div class="settings-row"><label>폰트</label>
                        <select id="setting-label-font-family">
                            <option value="gothic">기본(고딕)</option>
                            <option value="serif">명조체</option>
                            <option value="gulim">굴림체</option>
                            <option value="noto-sans">Noto Sans KR</option>
                            <option value="noto-serif">Noto Serif KR</option>
                        </select>
                    </div>
                    <div class="settings-row"><label>크기(pt)</label><input type="number" id="setting-label-font-size" min="8" max="20" step="0.5" placeholder="기본"></div>
                    <div class="settings-row">
                        <label>굵게</label>
                        <input type="checkbox" id="setting-label-bold">
                    </div>
                    <div class="settings-row">
                        <label>밑줄</label>
                        <input type="checkbox" id="setting-label-underline">
                    </div>
                </div>

                <div class="settings-panel" style="margin-bottom:0;">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">📌 머릿말/꼬릿말 서식</div>
                    <div class="template-controls active" data-target="header" data-template="free">
                        <div class="settings-row"><label>머릿말 폰트</label>
                            <select id="setting-header-free-font-family">
                                <option value="">기본</option>
                                <option value="gothic">고딕</option>
                                <option value="serif">명조</option>
                                <option value="gulim">굴림</option>
                                <option value="noto-sans">Noto Sans KR</option>
                                <option value="noto-serif">Noto Serif KR</option>
                            </select>
                        </div>
                        <div class="settings-row"><label>머릿말 크기(pt)</label><input type="number" id="setting-header-free-font-size" min="8" max="24" step="0.5" placeholder="기본"></div>
                        <div class="settings-row"><label>머릿말 굵기</label><input type="number" id="setting-header-free-font-weight" min="300" max="900" step="100" placeholder="기본"></div>
                        <div class="settings-row"><label>머릿말 정렬</label>
                            <select id="setting-header-free-align">
                                <option value="left">왼쪽</option>
                                <option value="center">가운데</option>
                                <option value="right">오른쪽</option>
                            </select>
                        </div>
                    </div>
                    <div class="template-controls active" data-target="header" data-template="table">
                        <div class="settings-row"><label>머릿말 행</label><input type="number" id="setting-header-table-rows" min="1" max="8" step="1"></div>
                        <div class="settings-row"><label>머릿말 열</label><input type="number" id="setting-header-table-cols" min="1" max="8" step="1"></div>
                    </div>
                    <div class="template-controls active" data-target="header" data-template="image">
                        <div class="settings-row">
                            <label>머릿말 이미지</label>
                            <div style="display:flex; gap:6px;">
                                <button class="btn btn-sm" data-action="header-image-upload">불러오기</button>
                                <button class="btn btn-sm" data-action="header-image-clear">제거</button>
                            </div>
                        </div>
                    </div>
                    <div class="template-controls active" data-target="footer" data-template="free">
                        <div class="settings-row"><label>꼬릿말 폰트</label>
                            <select id="setting-footer-free-font-family">
                                <option value="">기본</option>
                                <option value="gothic">고딕</option>
                                <option value="serif">명조</option>
                                <option value="gulim">굴림</option>
                                <option value="noto-sans">Noto Sans KR</option>
                                <option value="noto-serif">Noto Serif KR</option>
                            </select>
                        </div>
                        <div class="settings-row"><label>꼬릿말 크기(pt)</label><input type="number" id="setting-footer-free-font-size" min="8" max="24" step="0.5" placeholder="기본"></div>
                        <div class="settings-row"><label>꼬릿말 굵기</label><input type="number" id="setting-footer-free-font-weight" min="300" max="900" step="100" placeholder="기본"></div>
                        <div class="settings-row"><label>꼬릿말 정렬</label>
                            <select id="setting-footer-free-align">
                                <option value="left">왼쪽</option>
                                <option value="center">가운데</option>
                                <option value="right">오른쪽</option>
                            </select>
                        </div>
                    </div>
                    <div class="template-controls active" data-target="footer" data-template="table">
                        <div class="settings-row"><label>꼬릿말 행</label><input type="number" id="setting-footer-table-rows" min="1" max="8" step="1"></div>
                        <div class="settings-row"><label>꼬릿말 열</label><input type="number" id="setting-footer-table-cols" min="1" max="8" step="1"></div>
                    </div>
                    <div class="template-controls active" data-target="footer" data-template="image">
                        <div class="settings-row">
                            <label>꼬릿말 이미지</label>
                            <div style="display:flex; gap:6px;">
                                <button class="btn btn-sm" data-action="footer-image-upload">불러오기</button>
                                <button class="btn btn-sm" data-action="footer-image-clear">제거</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>페이지 구성</summary>
            <div class="sidebar-folder-body">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">공통</div>
                    <div class="settings-panel" style="margin-bottom:0;">
                        <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">테마 색상</div>
                        <div class="settings-row"><label>주색</label><input type="color" id="setting-theme-main"></div>
                        <div class="settings-row"><label>보조색</label><input type="color" id="setting-theme-sub"></div>
                        <div class="settings-row"><label>본문색</label><input type="color" id="setting-theme-text"></div>
                        <div class="settings-row"><label>헤더 글씨</label><input type="color" id="setting-theme-header-text"></div>
                        <div class="settings-row"><label>목차 글씨</label><input type="color" id="setting-theme-toc-text"></div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">목차</div>
                    <div class="settings-panel">
                        <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">목차 페이지</div>
                        <div class="settings-row"><label>헤더 높이(mm)</label><input type="number" id="setting-toc-header-height" min="50" max="140" step="1"></div>
                    </div>
                    <div class="sidebar-hint">목차 텍스트를 드래그하면 서체 설정이 나타납니다.</div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">대단원</div>
                    <div class="sidebar-hint">대단원 텍스트를 드래그하면 서체 설정이 나타납니다.</div>
                </div>
                <div class="sidebar-hint">페이지 우측 상단에서 페이지 유형(본문/목차/대단원/빈페이지)을 선택해 구성합니다.</div>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>삽입</summary>
            <div class="sidebar-folder-body">
                <button class="btn btn-success" data-action="insert-image-box">🖼️ 이미지 삽입 (Ctrl+Alt+I)</button>
                <button class="btn" data-action="insert-left-concept">⬅️ 좌컨셉 블록</button>
                <button class="btn" data-action="insert-top-concept">⬆️ 상단컨셉 블록</button>
                <button class="btn" data-action="insert-two-row-concept">🧩 2행컨셉 블록</button>
                <button class="btn" data-action="split-block">✂️ 블록 나누기 (Alt+Shift+Enter)</button>
                <button class="btn" data-action="add-spacer">↕ 여백 삽입 (Ctrl+Shift+Click)</button>
                <button class="btn" data-action="add-break">⚡ 단 나누기 삽입 (Ctrl+Alt+Click)</button>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>보기</summary>
            <div class="sidebar-folder-body">
                <div style="margin-bottom:10px;">
                    <span style="font-size:12px;">확대/축소</span>
                    <input type="range" id="zoomRange" min="0.5" max="1.5" step="0.1" value="1.0" style="width: 100%;">
                </div>
                <div class="settings-panel" style="margin-bottom:10px;">
                    <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">📄 레이아웃</div>
                    <div class="settings-row"><label>상/하 여백(mm)</label><input type="number" id="setting-margin-top" min="5" max="30" step="1"></div>
                    <div class="settings-row"><label>좌/우 여백(mm)</label><input type="number" id="setting-margin-side" min="5" max="30" step="1"></div>
                    <div class="settings-row"><label>단 간격(mm)</label><input type="number" id="setting-column-gap" min="0" max="20" step="1"></div>
                </div>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>도움말</summary>
            <div class="sidebar-folder-body">
                <div class="shortcut-guide">
                    <div class="shortcut-header">⌨️ 단축키 가이드</div>
                    <div class="shortcut-list">
                        <div class="shortcut-item"><span>아래에 추가</span><span class="shortcut-key">Enter</span></div>
                        <div class="shortcut-item"><span>위에 추가</span><span class="shortcut-key">Alt+Enter</span></div>
                        <div class="shortcut-item"><span>공백(10칸)</span><span class="shortcut-key">Sh+Tab</span></div>
                        <div class="shortcut-item"><span>블록 나누기</span><span class="shortcut-key">Alt+Shift+Enter</span></div>
                        <div class="shortcut-item"><span>단 나누기</span><span class="shortcut-key">Ctrl+Alt+Click</span></div>
                        <div class="shortcut-item"><span>여백 추가</span><span class="shortcut-key">Ctrl+Sh+Click</span></div>
                        <div class="shortcut-item"><span>블록 복제</span><span class="shortcut-key">Ctrl+D</span></div>
                        <div class="shortcut-item"><span>줄바꿈(수식앞)</span><span class="shortcut-key">Sh+Enter</span></div>
                        <div class="shortcut-item"><span>이미지 박스</span><span class="shortcut-key">Ctrl+Alt+I</span></div>
                        <div class="shortcut-item"><span>회색 배경</span><span class="shortcut-key">Ctrl+Alt+G</span></div>
                        <div class="shortcut-item"><span>테두리 박스</span><span class="shortcut-key">Ctrl+Alt+B</span></div>
                        <div class="shortcut-item"><span>실행 취소</span><span class="shortcut-key">Ctrl+Z</span></div>
                        <div class="shortcut-item"><span>저장하기</span><span class="shortcut-key">Ctrl+S</span></div>
                        <div class="shortcut-item"><span>찾기/바꾸기</span><span class="shortcut-key">Ctrl+Shift+F</span></div>
                    </div>
                </div>
            </div>
        </details>

        <details class="sidebar-folder">
            <summary>태그 설명</summary>
            <div class="sidebar-folder-body">
                <div class="sidebar-hint">블록 헤더: <code>[[스타일_라벨]] : 내용</code></div>
                <div class="sidebar-hint">머릿말: <code>[[머릿말_과정]] 과정명</code>, <code>[[머릿말_단원]] 단원명</code> (문서 최상단)</div>
                <div class="sidebar-hint">꼬릿말: <code>[[꼬릿말:내용]]</code> (없음: <code>[[꼬릿말:]]</code>)</div>
                <div class="sidebar-hint">스타일: <code>기본</code>, <code>박스</code>, <code>음영</code>, <code>개념</code>, <code>좌컨셉</code>, <code>상단컨셉</code>, <code>2행컨셉</code> (콤마로 조합)</div>
                <div class="sidebar-hint">컨셉 예시: <code>[[좌컨셉_Def.]]</code>, <code>[[상단컨셉_Visual Concept]]</code>, <code>[[2행컨셉_라벨]]</code>, <code>[[2행컨셉_라벨_서브라벨]]</code></div>
                <div class="sidebar-hint">라벨 없음: <code>[[기본_]]</code></div>
                <div class="sidebar-hint">수식: <code>$...$</code></div>
                <div class="sidebar-hint">개념빈칸: <code>[개념빈칸:#]정답[/개념빈칸]</code> (자동 번호/정답 모음)</div>
                <div class="sidebar-hint">독립 빈칸: <code>[빈칸: 내용]</code> 또는 <code>[빈칸_내용]</code></div>
                <div class="sidebar-hint">이미지: <code>[이미지: 설명]</code></div>
                <div class="sidebar-hint">서식 태그: <code>[BOLD: 내용]</code>, <code>[굵게: 내용]</code>, <code>[볼드: 내용]</code>, <code>[밑줄: 내용]</code></div>
                <div class="sidebar-hint">블록박스: <code>[블록박스_라벨]</code> ... <code>[/블록박스]</code></div>
                <div class="sidebar-hint">보기 박스: <code>[블록박스_보기]</code> ... <code>[/블록박스]</code></div>
                <div class="sidebar-hint">블록박스(라벨 없음): <code>[블록박스_]</code> ... <code>[/블록박스]</code></div>
                <div class="sidebar-hint">사각형 박스: <code>[블록사각형]</code> ... <code>[/블록사각형]</code></div>
                <div class="sidebar-hint">표: <code>[표_행x열]</code> : <code>(1x1_내용), (1x2_내용)</code></div>
                <div class="sidebar-hint">선지: <code>[선지_1행/2행/5행]</code> : <code>(1_내용), ...</code></div>
                <div class="sidebar-hint">쉼표/괄호 포함 내용은 <code>"내용"</code>으로 감싸고 <code>\"</code> 이스케이프</div>
            </div>
        </details>
    </div>
</nav>

<main class="workspace" id="workspace">
    <div id="paper-container"></div>
</main>

</body>
</html>

Filename: index.html
Full Content:
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Math Exam Editor v4.0.1 (Fixed)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <script src="js/config.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="module" src="js/main.js"></script>
</head>
<body>

<div id="loading-indicator">🔄 처리 중...</div>
<div id="drop-overlay">📂 파일 놓기 (Import)</div>
<input type="file" id="imgUpload" accept="image/*" style="display:none;">

<div id="import-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>📥 AI 데이터 입력 (호환 모드)</span>
            <span style="cursor:pointer;" onclick="closeModal('import-modal')">×</span>
        </div>
        <textarea id="import-textarea" class="modal-textarea" placeholder="데이터를 여기에 붙여넣으세요..."></textarea>
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn btn-warning" onclick="confirmImport(true)" style="width:auto;">덮어쓰기</button>
            <button class="btn btn-primary" onclick="confirmImport(false)" style="width:auto;">이어쓰기</button>
            <button class="btn" onclick="closeModal('import-modal')" style="width:auto;">취소</button>
        </div>
    </div>
</div>

<div id="find-replace-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="font-weight:bold; font-size:16px;">🔍 일괄 바꾸기</div>
        <div class="fr-row"><span class="fr-label">찾을 내용</span><input type="text" id="fr-find-input" class="fr-input"></div>
        <div class="fr-row"><span class="fr-label">바꿀 내용</span><input type="text" id="fr-replace-input" class="fr-input"></div>
        <div class="fr-actions">
            <button class="btn btn-primary btn-sm" onclick="executeFindReplace()">모두 바꾸기</button>
            <button class="btn btn-sm" onclick="closeModal('find-replace-modal')">닫기</button>
        </div>
    </div>
</div>

<div id="floating-toolbar">
    <button class="ft-btn" onmousedown="execStyle('bold')" title="굵게">B</button>
    <button class="ft-btn" onmousedown="execStyle('italic')" title="기울임">I</button>
    <button class="ft-btn" onmousedown="execStyle('underline')" title="밑줄">U</button>
    <div class="ft-sep"></div>
    <button class="ft-btn" onmousedown="execStyle('justifyLeft')">⇤</button>
    <button class="ft-btn" onmousedown="execStyle('justifyCenter')">↔</button>
    <button class="ft-btn" onmousedown="execStyle('justifyRight')">⇥</button>
    <div class="ft-sep"></div>
    <button class="ft-btn" onmousedown="execStyle('foreColor', '#dc3545')" style="color:#dc3545">●</button>
    <button class="ft-btn" onmousedown="execStyle('foreColor', '#007bff')" style="color:#007bff">●</button>
    <button class="ft-btn" onmousedown="execStyle('foreColor', '#000000')">●</button>
</div>

<div id="image-resizer"><div class="resizer-handle rh-se"></div></div>

<div id="context-menu">
    <div class="menu-title">블록 편집</div>
    <div class="menu-item" onclick="toggleGrayBg()"><span>🎨 회색 배경</span><span class="shortcut-badge">Ctrl+Alt+G</span></div>
    <div class="menu-item" onclick="toggleBorder()"><span>🔲 테두리 박스</span><span class="shortcut-badge">Ctrl+Alt+B</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="applyAlign('left')"><span>⇤ 왼쪽 정렬</span><span class="shortcut-badge">Ctrl+Sh+L</span></div>
    <div class="menu-item" onclick="applyAlign('center')"><span>↔ 가운데 정렬</span><span class="shortcut-badge">Ctrl+Sh+M</span></div>
    <div class="menu-item" onclick="applyAlign('right')"><span>⇥ 오른쪽 정렬</span><span class="shortcut-badge">Ctrl+Sh+R</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="duplicateTargetBlock()"><span>📋 복제하기</span><span class="shortcut-badge">Ctrl+D</span></div>
    <div class="menu-item" onclick="addBlockAbove('example')"><span>➕ 위에 추가</span><span class="shortcut-badge">Alt+Enter</span></div>
    <div class="menu-item" onclick="addBlockBelow('example')"><span>➕ 아래에 추가</span><span class="shortcut-badge">Enter</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="insertImageBoxSafe()"><span>🖼️ 이미지 박스 추가</span><span class="shortcut-badge">Ctrl+Alt+I</span></div>
    <div class="menu-item" onclick="addBlockBelow('spacer')"><span>↕ 여백 블록 추가</span><span class="shortcut-badge">Ctrl+Sh+Click</span></div>
    <div class="menu-item" onclick="addBlockBelow('break')"><span>⚡ 단 나누기 추가</span><span class="shortcut-badge">Ctrl+Alt+Click</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="deleteTargetBlock()" style="color:#dc3545;"><span>🗑️ 삭제하기</span><span class="shortcut-badge">Delete</span></div>
</div>

<nav class="sidebar">
    <div style="font-weight:bold; font-size:16px; margin-bottom:15px; border-bottom:2px solid #333; padding-bottom:5px;">
        📐 수학 에디터 v4.0
        <div style="font-size:10px; color:#666; font-weight:normal;">Modular Architecture (Fixed)</div>
    </div>
    
    <div class="settings-panel" style="background:#e8f5e9; border:1px solid #c8e6c9;">
        <div style="font-size:11px; font-weight:bold; margin-bottom:5px;">📂 로컬 작업 폴더 (선택)</div>
        <div id="folder-status">✅ 폴더 연결됨</div>
        <div class="settings-row"><label>이미지 폴더명</label><input type="text" id="setting-img-folder" value="images" style="width:80px;"></div>
        <button class="btn btn-success" onclick="FileSystem.openProjectFolder()">📂 작업 폴더 열기</button>
    </div>

    <button class="btn btn-purple" onclick="ManualRenderer.renderAll()" style="margin-bottom:15px; padding: 12px;">
        ⚡ 수식 변환 (Render)<br>
        <span style="font-size:10px; opacity:0.8;">Click: $..$ → SVG / DblClick: Edit</span>
    </button>

    <div style="margin-bottom:10px;">
        <span style="font-size:12px;">확대/축소</span>
        <input type="range" id="zoomRange" min="0.5" max="1.5" step="0.1" value="1.0" style="width: 100%;">
    </div>
    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
        <button class="btn" style="width:48%" onclick="performUndo()" title="실행 취소">↶ Undo<br><span style="font-size:9px;">(Ctrl+Z)</span></button>
        <button class="btn" style="width:48%" onclick="performRedo()" title="다시 실행">↷ Redo<br><span style="font-size:9px;">(Ctrl+Shift+Z)</span></button>
    </div>

    <button class="btn btn-success" onclick="insertImageBoxSafe()" style="margin-bottom:15px;">
        🖼️ 이미지 박스 넣기 (Ctrl+Alt+I)
    </button>

    <div class="settings-panel">
        <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">⚙️ AI 입력 설정</div>
        <div class="settings-row"><label>단별 문제 수</label><input type="number" id="setting-limit" value="0"></div>
        <div class="settings-row"><label>자동 여백</label><input type="checkbox" id="setting-spacer" checked></div>
    </div>

    <div style="border-top:1px solid #eee; padding-top:10px;">
        <button class="btn" onclick="openModal('import-modal')" style="border-left: 3px solid #6f42c1; color: #6f42c1; font-weight:bold;">📥 AI 데이터 입력 (Alt+I)</button>
        <button class="btn btn-warning" onclick="resetProject()">🗑️ 초기화 (Alt+N)</button>
        <button class="btn btn-primary" onclick="saveProjectJSON()">💾 저장 (Ctrl+S)</button>
        <button class="btn" onclick="document.getElementById('fileInput').click()">📂 열기 (Ctrl+O)</button>
        <input type="file" id="fileInput" accept=".json" style="display:none" onchange="loadProjectJSONFromInput(this)">
    </div>

    <div class="shortcut-guide">
        <div class="shortcut-header">⌨️ 단축키 가이드</div>
        <div class="shortcut-list">
            <div class="shortcut-item"><span>아래에 추가</span><span class="shortcut-key">Enter</span></div>
            <div class="shortcut-item"><span>위에 추가</span><span class="shortcut-key">Alt+Enter</span></div>
            <div class="shortcut-item"><span>공백(10칸)</span><span class="shortcut-key">Sh+Tab</span></div>
            <div class="shortcut-item"><span>단 나누기</span><span class="shortcut-key">Ctrl+Alt+Click</span></div>
            <div class="shortcut-item"><span>여백 추가</span><span class="shortcut-key">Ctrl+Sh+Click</span></div>
            <div class="shortcut-item"><span>블록 복제</span><span class="shortcut-key">Ctrl+D</span></div>
            <div class="shortcut-item"><span>줄바꿈(수식앞)</span><span class="shortcut-key">Sh+Enter</span></div>
            <div class="shortcut-item"><span>이미지 박스</span><span class="shortcut-key">Ctrl+Alt+I</span></div>
            <div class="shortcut-item"><span>회색 배경</span><span class="shortcut-key">Ctrl+Alt+G</span></div>
            <div class="shortcut-item"><span>테두리 박스</span><span class="shortcut-key">Ctrl+Alt+B</span></div>
            <div class="shortcut-item"><span>실행 취소</span><span class="shortcut-key">Ctrl+Z</span></div>
            <div class="shortcut-item"><span>저장하기</span><span class="shortcut-key">Ctrl+S</span></div>
        </div>
    </div>

    <div style="margin-top:auto;">
        <button class="btn btn-danger" onclick="printWithMath()">🖨️ 인쇄하기</button>
    </div>
</nav>

<main class="workspace" id="workspace">
    <div id="paper-container"></div>
</main>

</body>
</html>
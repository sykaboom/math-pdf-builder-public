Filename: index.html
Full Content:
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Math Exam Editor v4.0.1 (Fixed)</title>
	    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@400;700&family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    
    <script src="js/config.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="module" src="js/main.js"></script>
</head>
<body>

<div id="loading-indicator">🔄 처리 중...</div>
<div id="toast-container"></div>
<div id="drop-overlay">📂 파일 놓기 (Import)</div>
<input type="file" id="imgUpload" accept="image/*" style="display:none;">

<div id="import-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>📥 AI 데이터 입력 (호환 모드)</span>
            <span style="cursor:pointer;" onclick="closeModal('import-modal')">×</span>
        </div>
        <textarea id="import-textarea" class="modal-textarea" placeholder="데이터를 여기에 붙여넣으세요..."></textarea>
        <div style="display:flex; justify-content:flex-end; gap:10px;">
            <button class="btn btn-warning" onclick="confirmImport(true)" style="width:auto;">덮어쓰기</button>
            <button class="btn btn-primary" onclick="confirmImport(false)" style="width:auto;">이어쓰기</button>
            <button class="btn" onclick="closeModal('import-modal')" style="width:auto;">취소</button>
        </div>
    </div>
</div>

<div id="find-replace-modal" class="modal-overlay">
    <div class="modal-content">
        <div style="font-weight:bold; font-size:16px;">🔍 일괄 바꾸기</div>
        <div class="fr-row"><span class="fr-label">찾을 내용</span><input type="text" id="fr-find-input" class="fr-input"></div>
        <div class="fr-row"><span class="fr-label">바꿀 내용</span><input type="text" id="fr-replace-input" class="fr-input"></div>
        <div class="fr-actions">
            <button class="btn btn-primary btn-sm" onclick="executeFindReplace()">모두 바꾸기</button>
            <button class="btn btn-sm" onclick="closeModal('find-replace-modal')">닫기</button>
        </div>
    </div>
</div>

<div id="print-preflight-modal" class="modal-overlay">
    <div class="modal-content" style="width:420px; gap:12px;">
        <div style="font-weight:bold; display:flex; justify-content:space-between;">
            <span>🖨️ 인쇄 전 점검</span>
            <span style="cursor:pointer;" onclick="closeModal('print-preflight-modal')">×</span>
        </div>
        <div id="print-preflight-body" style="font-size:13px; line-height:1.6; color:#333;"></div>
        <div style="display:flex; justify-content:flex-end; gap:8px;">
            <button class="btn btn-purple btn-sm" onclick="printPreflightAction('render')">수식 변환 후 인쇄</button>
            <button class="btn btn-danger btn-sm" onclick="printPreflightAction('print')">그대로 인쇄</button>
            <button class="btn btn-sm" onclick="printPreflightAction('cancel')">취소</button>
        </div>
    </div>
</div>

<div id="floating-toolbar">
    <button class="ft-btn" onmousedown="execStyle('bold')" title="굵게">B</button>
    <button class="ft-btn" onmousedown="execStyle('italic')" title="기울임">I</button>
    <button class="ft-btn" onmousedown="execStyle('underline')" title="밑줄">U</button>
    <div class="ft-sep"></div>
    <button class="ft-btn" onmousedown="execStyle('justifyLeft')">⇤</button>
    <button class="ft-btn" onmousedown="execStyle('justifyCenter')">↔</button>
    <button class="ft-btn" onmousedown="execStyle('justifyRight')">⇥</button>
    <div class="ft-sep"></div>
    <button class="ft-btn" onmousedown="execStyle('foreColor', '#dc3545')" style="color:#dc3545">●</button>
    <button class="ft-btn" onmousedown="execStyle('foreColor', '#007bff')" style="color:#007bff">●</button>
    <button class="ft-btn" onmousedown="execStyle('foreColor', '#000000')">●</button>
</div>

<div id="image-resizer"><div class="resizer-handle rh-se"></div></div>

<div id="context-menu">
    <div class="menu-title">블록 편집</div>
    <div class="menu-item" onclick="toggleGrayBg()"><span>🎨 회색 배경</span><span class="shortcut-badge">Ctrl+Alt+G</span></div>
    <div class="menu-item" onclick="toggleBorder()"><span>🔲 테두리 박스</span><span class="shortcut-badge">Ctrl+Alt+B</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="applyAlign('left')"><span>⇤ 왼쪽 정렬</span><span class="shortcut-badge">Ctrl+Sh+L</span></div>
    <div class="menu-item" onclick="applyAlign('center')"><span>↔ 가운데 정렬</span><span class="shortcut-badge">Ctrl+Sh+M</span></div>
    <div class="menu-item" onclick="applyAlign('right')"><span>⇥ 오른쪽 정렬</span><span class="shortcut-badge">Ctrl+Sh+R</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="duplicateTargetBlock()"><span>📋 복제하기</span><span class="shortcut-badge">Ctrl+D</span></div>
    <div class="menu-item" onclick="addBlockAbove('example')"><span>➕ 위에 추가</span><span class="shortcut-badge">Alt+Enter</span></div>
    <div class="menu-item" onclick="addBlockBelow('example')"><span>➕ 아래에 추가</span><span class="shortcut-badge">Enter</span></div>
    <div class="menu-sep"></div>
    <div class="menu-item" onclick="addImageBlockBelow()"><span>🖼️ 이미지 블록 아래 추가</span><span class="shortcut-badge">Ctrl+Alt+I</span></div>
    <div class="menu-item" onclick="insertImagePlaceholderAtEnd()"><span>🖼️ 블록 안에 이미지 추가</span><span class="shortcut-badge">-</span></div>
	    <div class="menu-item" onclick="addBlockBelow('spacer')"><span>↕ 여백 블록 추가</span><span class="shortcut-badge">Ctrl+Sh+Click</span></div>
	    <div class="menu-item" onclick="addBlockBelow('break')"><span>⚡ 단 나누기 추가</span><span class="shortcut-badge">Ctrl+Alt+Click</span></div>
	    <div class="menu-sep"></div>
	    <div class="menu-title">폰트</div>
	    <div class="menu-item menu-font-row">
	        <select id="block-font-family-select">
	            <option value="default">기본</option>
	            <option value="serif">명조</option>
	            <option value="gulim">굴림</option>
	            <option value="gothic">나눔고딕</option>
	        </select>
	        <input type="number" id="block-font-size-input" min="8" max="20" step="0.5" style="width:60px;">
	        <button class="btn btn-sm" onclick="applyBlockFont()">적용</button>
	    </div>
	    <div class="menu-sep"></div>
	    <div class="menu-item" onclick="deleteTargetBlock()" style="color:#dc3545;"><span>🗑️ 삭제하기</span><span class="shortcut-badge">Delete</span></div>
</div>

<nav class="sidebar">
    <div class="sidebar-header" style="font-weight:bold; font-size:16px; margin-bottom:15px; border-bottom:2px solid #333; padding-bottom:5px;">
        📐 수학 에디터 v4.0
        <div style="font-size:10px; color:#666; font-weight:normal;">Modular Architecture (Fixed)</div>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-section-title">프로젝트</div>
        <button class="btn" onclick="openModal('import-modal')" style="border-left: 3px solid #6f42c1; color: #6f42c1; font-weight:bold;">📥 AI 데이터 입력 (Alt+I)</button>
        <button class="btn btn-warning" onclick="resetProject()">🗑️ 새로 만들기 (Alt+N)</button>
        <button class="btn btn-primary" onclick="saveProjectJSON()">💾 저장 (Ctrl+S)</button>
        <button class="btn" onclick="document.getElementById('fileInput').click()">📂 열기 (Ctrl+O)</button>
        <input type="file" id="fileInput" accept=".json" style="display:none" onchange="loadProjectJSONFromInput(this)">

        <div class="settings-panel" style="background:#e8f5e9; border:1px solid #c8e6c9; margin-top:10px;">
            <div style="font-size:11px; font-weight:bold; margin-bottom:5px;">📂 로컬 작업 폴더</div>
            <div id="folder-status">⬇️ 저장: 다운로드</div>
            <div class="settings-row"><label>이미지 폴더명</label><input type="text" id="setting-img-folder" value="images" style="width:80px;"></div>
            <button class="btn btn-success" onclick="FileSystem.openProjectFolder()">📂 작업 폴더 열기</button>
        </div>

	        <div class="settings-panel">
	            <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">⚙️ AI 입력 설정</div>
	            <div class="settings-row"><label>단별 문제 수</label><input type="number" id="setting-limit" value="0"></div>
	            <div class="settings-row"><label>자동 여백</label><input type="checkbox" id="setting-spacer" checked></div>
	        </div>

	        <div class="settings-panel" style="margin-bottom:0;">
	            <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">🔤 기본 폰트</div>
	            <div class="settings-row"><label>폰트</label>
	                <select id="setting-font-family">
	                    <option value="serif">기본(명조)</option>
	                    <option value="gulim">굴림체</option>
	                    <option value="gothic">나눔고딕</option>
	                </select>
	            </div>
	            <div class="settings-row"><label>크기(pt)</label><input type="number" id="setting-font-size" min="8" max="20" step="0.5"></div>
	        </div>
	    </div>

    <div class="sidebar-section">
        <div class="sidebar-section-title">편집</div>
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
            <button class="btn" style="width:48%" onclick="performUndo()" title="실행 취소">↶ Undo<br><span style="font-size:9px;">(Ctrl+Z)</span></button>
            <button class="btn" style="width:48%" onclick="performRedo()" title="다시 실행">↷ Redo<br><span style="font-size:9px;">(Ctrl+Shift+Z)</span></button>
        </div>
        <button class="btn" onclick="openModal('find-replace-modal'); document.getElementById('fr-find-input').focus()">🔍 찾기/바꾸기 (Ctrl+Shift+H)</button>
    </div>

    <div class="sidebar-section">
        <div class="sidebar-section-title">삽입</div>
        <button class="btn btn-success" onclick="insertImageBoxSafe()">🖼️ 이미지 삽입 (Ctrl+Alt+I)</button>
        <button class="btn" onclick="addBlockBelow('spacer')">↕ 여백 삽입</button>
        <button class="btn" onclick="addBlockBelow('break')">⚡ 단 나누기 삽입</button>
    </div>

	    <div class="sidebar-section">
	        <div class="sidebar-section-title">보기</div>
	        <div style="margin-bottom:10px;">
	            <span style="font-size:12px;">확대/축소</span>
	            <input type="range" id="zoomRange" min="0.5" max="1.5" step="0.1" value="1.0" style="width: 100%;">
	        </div>
	        <div class="settings-panel" style="margin-bottom:0;">
	            <div style="font-size:11px; font-weight:bold; margin-bottom:5px; border-bottom:1px solid #ddd; padding-bottom:3px;">📄 레이아웃</div>
	            <div class="settings-row"><label>단 구성</label>
	                <select id="setting-columns">
	                    <option value="2">2단</option>
	                    <option value="1">1단</option>
	                </select>
	            </div>
	            <div class="settings-row"><label>상/하 여백(mm)</label><input type="number" id="setting-margin-top" min="5" max="30" step="1"></div>
	            <div class="settings-row"><label>좌/우 여백(mm)</label><input type="number" id="setting-margin-side" min="5" max="30" step="1"></div>
	            <div class="settings-row"><label>단 간격(mm)</label><input type="number" id="setting-column-gap" min="0" max="20" step="1"></div>
	            <div class="settings-row"><label>푸터 텍스트</label><input type="text" id="setting-footer-text"></div>
	        </div>
	    </div>

	    <div class="sidebar-section">
	        <div class="sidebar-section-title">출력</div>
	        <div id="preflight-panel" class="settings-panel preflight-panel" style="margin-bottom:8px;">
	            <div class="preflight-item" data-type="math">미렌더 수식: <span id="preflight-math-count">0</span>개</div>
	            <div class="preflight-item" data-type="image">미삽입 이미지 박스: <span id="preflight-image-count">0</span>개</div>
	        </div>
	        <button class="btn btn-purple" onclick="ManualRenderer.renderAll()" style="margin-bottom:8px; padding: 12px;">
	            ⚡ 수식 변환 (Render)<br>
	            <span style="font-size:10px; opacity:0.8;">Click: $..$ → SVG / DblClick: Edit</span>
	        </button>
        <button class="btn btn-danger" onclick="printWithMath()">🖨️ 인쇄하기</button>
    </div>

    <div class="shortcut-guide">
        <div class="shortcut-header">⌨️ 단축키 가이드</div>
        <div class="shortcut-list">
            <div class="shortcut-item"><span>아래에 추가</span><span class="shortcut-key">Enter</span></div>
            <div class="shortcut-item"><span>위에 추가</span><span class="shortcut-key">Alt+Enter</span></div>
            <div class="shortcut-item"><span>공백(10칸)</span><span class="shortcut-key">Sh+Tab</span></div>
            <div class="shortcut-item"><span>단 나누기</span><span class="shortcut-key">Ctrl+Alt+Click</span></div>
            <div class="shortcut-item"><span>여백 추가</span><span class="shortcut-key">Ctrl+Sh+Click</span></div>
            <div class="shortcut-item"><span>블록 복제</span><span class="shortcut-key">Ctrl+D</span></div>
            <div class="shortcut-item"><span>줄바꿈(수식앞)</span><span class="shortcut-key">Sh+Enter</span></div>
            <div class="shortcut-item"><span>이미지 박스</span><span class="shortcut-key">Ctrl+Alt+I</span></div>
            <div class="shortcut-item"><span>회색 배경</span><span class="shortcut-key">Ctrl+Alt+G</span></div>
            <div class="shortcut-item"><span>테두리 박스</span><span class="shortcut-key">Ctrl+Alt+B</span></div>
	            <div class="shortcut-item"><span>실행 취소</span><span class="shortcut-key">Ctrl+Z</span></div>
	            <div class="shortcut-item"><span>저장하기</span><span class="shortcut-key">Ctrl+S</span></div>
	            <div class="shortcut-item"><span>찾기/바꾸기</span><span class="shortcut-key">Ctrl+Shift+H</span></div>
	        </div>
	    </div>
</nav>

<main class="workspace" id="workspace">
    <div id="paper-container"></div>
</main>

</body>
</html>

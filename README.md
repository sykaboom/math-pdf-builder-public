Math Exam Editor v4.2 (Modular Architecture)
이 프로젝트는 전문가용 웹 기반 수식 시험지 편집기입니다.
유지보수와 기능 확장을 위해 SSOT(Single Source of Truth) 원칙과 모듈형 구조로 설계되었습니다.

## 아키텍처 가이드라인
- 미래 통합 기준과 코드 점검 원칙: `PROJECT_BLUEPRINT.md`
- 개념빈칸 동작 명세: `docs/concept-blank.md`

## 사용하기 (배포판)
- GitHub Pages: https://sykaboom.github.io/math-pdf-builder-public/
- 최신 Chromium 계열 브라우저(Chrome/Edge) 권장
- ES Modules 특성상 `file://`로 직접 열면 동작이 불안정할 수 있으니 위 주소로 접속하세요

## 빠른 시작

### 1) 블록 편집
- 본문을 클릭해 타이핑합니다.
- `Enter`: 아래에 예제 블록 추가
- `Alt+Enter`: 위에 예제 블록 추가
- `Ctrl+Alt+클릭`: 단 나누기(2단 전환) 삽입
- `Ctrl+Shift+클릭`: 여백 블록 삽입
- 좌컨셉/상단컨셉/2단컨셉 블록은 `삽입` 또는 블록 메뉴에서 추가합니다.

### 2) 렌더링 / 수식
- 수식 입력: `$...$`(인라인), `$$...$$`(디스플레이)
- 기본은 렌더링 해제 상태입니다. 사이드바 `렌더링 적용/해제`로 전환합니다.
- 렌더 모드에서 수식/빈칸/박스/표/선지/이미지는 **더블클릭 메뉴**로 편집합니다.
- 렌더 모드에서 더블클릭 메뉴의 `렌더링 해제`로 **해당 요소만** 토큰 편집 상태로 전환합니다.

### 3) 개념빈칸 / 빈칸
- 개념빈칸: `[개념빈칸:#]정답[/개념빈칸]` (자동 번호, 빠른 정답 모음에 자동 수집)
- 빈칸: `[빈칸:내용]` 또는 `[빈칸_내용]` (정답 연결 없음)
- 개념빈칸 정답 블록은 기본 1개로 자동 생성되며 이동 가능
- 개념빈칸 정답 블록 분할: `Alt+Shift+Enter`
- 개념빈칸 정답 모음 블록에서 **항목 더블클릭 → 정답 편집** 가능
- 개념빈칸 정답 모음 블록에서 **스페이스/Shift+Enter로 간격 조정** 가능

### 4) 이미지
- 텍스트로 `[이미지:라벨]` 입력하거나 `삽입 → 이미지 삽입`으로 추가
- 플레이스홀더의 **불러오기** 버튼으로 이미지 선택
- 커서가 있는 상태에서 `Ctrl+V`로 이미지 붙여넣기 가능

### 5) 표(테이블) / 선지
- 표 삽입: `[표_행x열]` 예) `[표_3x4]`
- 표 데이터 입력 예시:
  ```
  [표_3x4] : (1x1_" "), (1x2_"$a>0$"), (1x3_"$a=0$"), (1x4_"$a<0$")
  ```
- 셀을 클릭해 직접 입력합니다. 수식은 `$...$`로 입력합니다.
- 셀 경계 드래그로 행/열 크기를 조절합니다.

### 6) 저장 / 열기 / 출력
- `저장(Ctrl+S)`은 JSON 파일로 저장됩니다.
- `열기(Ctrl+O)`로 JSON을 다시 불러옵니다.
- `출력`의 품질 체크리스트에서 미렌더 수식/미삽입 이미지 개수를 확인합니다.
- `인쇄하기`는 preflight 경고 후 브라우저 인쇄 다이얼로그를 엽니다.

### 7) 머릿말/꼬릿말
- 각 페이지의 머릿말/꼬릿말 영역에서 템플릿(시험지/기본/프리박스/표/이미지/없음)과 높이(mm)를 선택합니다.
- 시험지 템플릿 머릿말 높이는 고정이며, 시험지 모드에서 머릿말 없음은 12mm로 유지됩니다.
- 프리박스/표는 직접 편집되고, 이미지 템플릿은 불러오기 후 드래그/리사이즈할 수 있습니다.
- 프리박스 서식/표 행·열/이미지 불러오기는 사이드바의 머릿말·꼬릿말 서식에서 조정합니다.
- 시험지 템플릿 꼬릿말은 페이지 번호+가로줄만 표시됩니다.
- 기본 템플릿은 상단/하단 가로줄과 페이지 번호만 표시합니다.
- 머릿말(과정/단원)은 시험지 헤더 표에서 직접 입력하거나 머릿말 태그로 입력합니다.

### 8) 프롬프트 다운로드
- 사이드바 `프롬프트` 섹션에서 아래 파일을 다운로드할 수 있습니다.
  - 1차 데이터추출 프롬프트
  - 2차 변환 프롬프트
  - 콘텐츠 정의(수악중독)
- 버튼 옆에 업데이트 날짜가 표시됩니다.

### 9) 페이지 구성
- 각 페이지 우측 상단에서 **페이지 유형**(본문/목차/대단원/빈페이지)을 선택해 구성합니다.
- 본문 페이지는 1단/2단 구성을 선택할 수 있습니다.
- 사이드바의 `페이지 제어 숨김`으로 페이지 내 제어상자를 숨기거나 다시 표시할 수 있습니다.
- 목차 제목/부제는 직접 수정할 수 있고, 항목 추가/삭제 및 L1~L3 레벨을 지원합니다.
- L1(로마자), L2(Part), L3(01~) 번호는 자동 표기됩니다.
- 대단원 표지는 번호/제목/학습 포인트(제목 포함)/파트 목록을 직접 편집할 수 있습니다.
- 헤더 높이(mm)와 테마 색상(주색/보조색/본문색)을 설정할 수 있습니다.
- 헤더 배경 이미지와 오버레이 이미지를 각각 추가/변경할 수 있습니다.
- 헤더 이미지는 드래그/리사이즈로 위치와 크기를 조정할 수 있습니다.
- 템플릿(목차/대단원/빈페이지)은 계속 확장 예정입니다.

## AI 데이터 입력
- `Alt+I`로 AI 데이터 입력 모달을 엽니다.
- 텍스트를 붙여넣고 변환하면 블록이 생성됩니다.
- 머릿말 메타 태그(문서 최상단 1줄씩): `[[머릿말_과정]]`(시험지 제목), `[[머릿말_단원]]`(단원명)
- 꼬릿말 메타 태그는 저장만 되며 시험지 템플릿에서는 표시되지 않습니다(텍스트는 프리박스/표 템플릿 사용).
- 예시: `[[머릿말_과정]] 대수` / `[[머릿말_단원]] 3.1 등차수열과 등비수열`

## 유지보수 가이드
"지금 무엇을 고치고 싶으신가요?"

### 1) 화면에 보이는 것을 고치고 싶을 때 (View & UI)
- `index.html`: UI 구조, 모달/버튼 추가
- `css/style.css`: 색상/여백/폰트/인쇄 스타일
- `js/renderer.js`: 페이지 레이아웃과 DOM 렌더링

### 2) 동작과 규칙을 바꾸고 싶을 때 (Logic & Behavior)
- `js/actions.js`: 블록 추가/삭제/복제 등 데이터 규칙
- `js/events.js`: 단축키/클릭/드래그 입력 처리
- `js/table-editor.js`: 표/선지 편집 동작

### 3) 데이터와 설정을 다루고 싶을 때 (Data & Config)
- `js/state.js`: 전체 상태/히스토리 관리
- `js/state-normalize.js`: 기본값/문서 초기 구조
- `js/services.js`: MathJax 렌더링, 저장/불러오기
- `js/config.js`: MathJax 초기 설정

### 4) 기타 유틸
- `js/utils.js`: 공통 유틸
- `js/main.js`: 초기화 진입점
- `js/import-parser.js`: AI 입력 파싱

## 개발 및 실행 팁
- 캐시가 남아 변경이 안 보일 때: 강력 새로고침
  - Windows: `Ctrl+Shift+R`
  - Mac: `Cmd+Shift+R`
- `file://`로 열면 일부 기능이 제한될 수 있으니 GitHub Pages 또는 로컬 서버로 실행하세요.

📐 Math Exam Editor v4.2 (Modular Architecture)
이 프로젝트는 전문가를 위한 웹 기반 수식 시험지 편집기입니다.

유지보수와 기능 확장을 위해 SSOT(Single Source of Truth) 원칙과 모듈형 아키텍처(Modular Architecture) 로 설계되었습니다.

AI(LLM)를 이용해 코드를 수정할 때, 전체 코드를 뒤질 필요 없이 **"수정하려는 목적"**에 맞는 파일 하나만 선택하면 됩니다.

## 사용하기 (배포판)
- GitHub Pages: https://sykaboom.github.io/math-pdf-builder-public/
- 최신 Chromium 계열 브라우저(Chrome/Edge) 권장.
- ES Modules 특성상 `file://`로 직접 열면 동작이 불안정할 수 있으니 위 주소로 접속하세요.

### 빠른 시작
1) **블록 편집**
- 본문을 클릭해 타이핑합니다.  
- `Enter` : 아래에 예제 블록 추가  
- `Alt+Enter` : 위에 예제 블록 추가  
- `Ctrl+Alt+Click` : 단 나누기(2단 전환) 삽입  
- `Ctrl+Shift+Click` : 여백 블록 삽입  

2) **수식 / 빈칸 / 이미지**
- **수식 입력**: `$...$`(인라인), `$$...$$`(디스플레이).  
  - 렌더 모드가 켜져 있으면 블록 포커스가 바뀌는 순간 자동 렌더링됩니다.  
  - `출력 → 렌더링 해제/적용` 토글로 전체를 “편집 모드(소스 유지)”로 전환할 수 있습니다.  
  - 렌더 모드 ON에서 렌더된 수식을 **더블클릭**하면 다시 `$...$`로 돌아갑니다.
- **개념 빈칸**: `[개념빈칸:#]정답[/개념빈칸]` (자동 번호, 빠른 정답 모음에 자동 수집).  
  - 렌더 모드 ON에서 더블클릭하면 `[개념빈칸:...]` 편집으로 돌아옵니다.
  - 개념 빈칸 정답 블록은 자동 생성되며, 이동/Alt+Shift+Enter 분할이 가능합니다.
- **독립 빈칸**: `[빈칸:내용]` 또는 `[빈칸_내용]` (텍스트/수식 공통, 정답 연결 없음).  
  - 렌더 모드 ON에서 더블클릭하면 `[빈칸:...]` 편집으로 돌아옵니다.
- **이미지 박스**:
  - 텍스트로 직접 `[이미지:라벨]` 입력하거나, 사이드바 `삽입 → 이미지 삽입`으로 플레이스홀더를 넣습니다.
  - 플레이스홀더 안의 **불러오기** 버튼 클릭으로 이미지를 선택합니다.
  - 플레이스홀더를 선택한 뒤 `Ctrl+V`로 이미지 붙여넣기도 가능합니다.
  - 렌더 모드 ON에서 플레이스홀더 **더블클릭** 시 `[이미지:...]` 텍스트로 편집 가능합니다.

3) **표(테이블)**
- **삽입**: `[표_행x열]` 예) `[표_3x4]` (텍스트 흐름 안에 인라인으로 삽입됩니다)
- **AI 데이터 셀 입력**:
  ```
  [표_3x4] : (1x1_" "), (1x2_"$a>0$"), (1x3_"$a=0$"), (1x4_"$a<0$")
  ```
  - 좌표는 1부터 시작합니다.  
  - 셀 내용은 `"..."`로 감싸는 것을 권장합니다. `"`가 필요하면 `\"`로 이스케이프합니다.
- **편집**: 셀을 클릭해 직접 입력합니다. 수식은 `$...$`로 입력합니다.
- **크기 조절**: 셀의 오른쪽/아래 경계를 드래그하면 열/행 크기가 바뀌고, 표 우하단 핸들을 드래그하면 전체 크기가 바뀝니다.

4) **블록박스(보기/조건/Tip 등) – AI 입력용**
- AI 데이터 입력에서 다음 문법을 지원합니다.  
  - 멀티라인:  
    ```
    [블록박스_라벨]
    내용...
    [/블록박스]
    ```
  - 인라인(한 줄): `[블록박스_라벨] 내용`
  - 라벨이 비어 있으면 단순 박스만 생성됩니다: `[블록박스_]`

5) **레이아웃 / 폰트**
- `보기 → 레이아웃`에서 1단/2단, 여백(mm), 단 간격(mm), 푸터 텍스트를 조절합니다.
  - 사이드바의 레이아웃은 **기본값**이고, 각 페이지 우상단에서 1단/2단을 개별 선택할 수 있습니다(인쇄 시 숨김).
- `프로젝트 → 기본 폰트`에서 전역 폰트(명조/굴림/나눔고딕)와 크기(pt)를 설정합니다.  
  - AI 데이터 입력 전에 기본 폰트를 정해두면 import 결과에 적용됩니다.
- 블록별로 다른 폰트를 쓰고 싶으면 **블록 핸들(≡) 메뉴 → 폰트**에서 개별 적용합니다.

6) **찾기 / 바꾸기**
- `Ctrl+Shift+F`로 실행합니다.
- 바꾸기 결과는 토스트로 처리 개수를 안내합니다.

7) **저장 / 열기 / 출력**
- `저장(Ctrl+S)`은 JSON 파일로 저장됩니다.  
  - 로컬 폴더를 연결하면 같은 폴더에 저장되고, 이미지도 함께 관리됩니다.
- `열기(Ctrl+O)`로 JSON을 다시 불러옵니다.
- `출력` 섹션의 품질 체크리스트에서 **미렌더 수식/미삽입 이미지** 개수를 확인하고, 항목 클릭 시 해당 위치로 이동합니다.
- `인쇄하기`는 preflight 경고 후 브라우저 인쇄 다이얼로그를 엽니다.

8) **프롬프트 다운로드**
- 사이드바 `프롬프트` 섹션에서 4.0 프롬프트 txt 파일을 다운로드할 수 있습니다.
- 버튼 옆에 GitHub 기준의 업데이트 날짜가 표시됩니다.

🛠️ 상황별 수정 가이드 (Maintenance Guide)
"지금 무엇을 고치고 싶으신가요?"

아래의 상황 분류를 보고 해당하는 파일을 수정하십시오.

1. 화면에 보이는 것을 고치고 싶을 때 (View & UI)
📄 index.html (건물의 뼈대)
"새로운 버튼이나 팝업창을 추가해야 해요."

역할: 웹페이지의 HTML 구조를 정의합니다. 외부 라이브러리 로딩 순서도 여기서 관리합니다.

이럴 때 수정하세요:

사이드바에 'PDF 다운로드' 같은 새로운 버튼을 만들고 싶을 때.

화면 중앙에 새로운 안내 모달(팝업창) 구조를 추가할 때.

MathJax 외에 다른 외부 라이브러리(CDN) 를 가져와야 할 때.

주의: 단순 디자인 변경이나 기능 로직은 이곳이 아닙니다.

🎨 css/style.css (인테리어 및 디자인)
"버튼 색상을 바꾸거나, 여백을 조절하고 싶어요."

역할: 모든 시각적 스타일(색상, 폰트, 간격, 테두리)을 담당합니다.

이럴 때 수정하세요:

버튼의 색상, 크기, 마우스 오버 효과를 변경할 때.

시험지 본문의 줄 간격(line-height) 이나 폰트를 바꾸고 싶을 때.

인쇄 시(@media print) 특정 버튼을 숨기거나 여백을 조정할 때.

🖌️ js/renderer.js (화가)
"시험지 표 모양을 바꾸거나, 페이지가 넘어가는 기준을 고치고 싶어요."

역할: 데이터를 받아 실제 HTML(DOM)을 그리고, A4 용지 높이에 맞춰 레이아웃을 계산합니다.

이럴 때 수정하세요:

헤더(점수란, 결재란) 표의 HTML 구조(<table>)를 변경하고 싶을 때.

블록이 생성될 때 같이 붙는 작은 메뉴 버튼들(단 나누기 등) 의 위치를 옮길 때.

페이지 레이아웃 밸런싱(Rebalance) 로직(단 높이 계산)을 수정할 때.

수식을 입력했을 때 화면에 반영되는 타이밍(Sync)을 조절할 때.

페이지별 1단/2단 선택 UI를 변경하고 싶을 때.

2. 동작과 규칙을 바꾸고 싶을 때 (Logic & Behavior)
🧠 js/actions.js (두뇌 / 비즈니스 로직)
"삭제할 때 확인 창을 없애거나, 복제 규칙을 바꾸고 싶어요."

역할: 데이터(Blocks)를 추가, 삭제, 변경하는 순수한 규칙을 정의합니다. 화면을 어떻게 그릴지는 신경 쓰지 않습니다.

이럴 때 수정하세요:

블록 삭제 시 confirm 창 없이 바로 지우게 하고 싶을 때.

블록 추가 시 기본으로 들어가는 텍스트("내용 입력...")를 바꾸고 싶을 때.

블록 복제 시 내용은 복사하되 스타일(배경색 등)은 초기화하고 싶을 때.

붙여넣기한 텍스트를 파싱하는 규칙을 변경할 때.

🎮 js/events.js (신경망 / 입력 감지)
"단축키를 바꾸거나, 드래그 동작을 수정하고 싶어요."

역할: 사용자의 키보드, 마우스, 드래그 입력을 감지하여 적절한 로직(Actions)을 연결합니다.

이럴 때 수정하세요:

단축키를 변경하거나 추가할 때 (예: Ctrl+D → Alt+D).

이미지 드래그 앤 드롭 시 허용되는 파일 형식을 바꾸거나 감도를 조절할 때.

블록을 클릭했을 때 포커스(Focus) 가 잡히는 방식을 수정할 때.

스크롤 시 팝업 메뉴가 닫히는 동작 등을 제어할 때.

표의 행/열/전체 크기 드래그 동작을 변경하고 싶을 때.

3. 데이터와 설정을 다루고 싶을 때 (Data & Config)
💾 js/state.js (기억 저장소)
"실행 취소 횟수를 늘리거나, 기본 제목을 바꾸고 싶어요."

역할: 시험지 데이터(docData)와 실행 취소(History), 현재 선택된 상태 등 모든 상태 값을 관리합니다.

이럴 때 수정하세요:

실행 취소(Undo) 가능한 최대 횟수(기본 30개)를 늘리고 싶을 때.

새 문서 생성 시 기본 제목/단원명을 변경하고 싶을 때.

전역적으로 공유해야 할 변수가 생겼을 때.

🔌 js/services.js (외부 기술 지원)
"파일 저장 방식이나 수식 렌더링 설정을 바꾸고 싶어요."

역할: MathJax 엔진 호출, 로컬 파일 시스템 저장, JSON 다운로드 등 기술적인 외부 연동을 담당합니다.

이럴 때 수정하세요:

MathJax 수식 폰트 설정을 디테일하게 튜닝하고 싶을 때.

파일 저장 시 날짜 포맷(YYYYMMDD)을 파일명에 넣고 싶을 때.

로컬 이미지 저장 로직을 변경하고 싶을 때.

AI 데이터 토큰(빈칸/이미지/블록박스/표) 파싱 규칙을 변경하고 싶을 때.

⚙️ js/config.js (초기 설정)
역할: MathJax 라이브러리가 로드되기 전, 수식 인식 기호($, $$) 등을 정의합니다.

이럴 때 수정하세요: 수식 델리미터(구분자)를 변경해야 할 때.

4. 기타 도구
🔧 js/utils.js (공구함)
단순 반복 작업(Debounce, HTML 태그 제거 등)을 위한 헬퍼 함수들이 모여 있습니다.

🚀 js/main.js (지휘자)
앱이 시작될 때(DOMContentLoaded) 모든 모듈을 연결하고 초기화하는 진입점입니다.

⚡ 개발 및 실행 팁 (Important)
1. 수정 사항이 반영되지 않을 때 (캐시 문제)
코드를 수정하고 GitHub Pages 등에 올렸는데도 예전 버전으로 보인다면 브라우저 캐시 때문입니다.

강력 새로고침 단축키:

Windows: Ctrl + Shift + R

Mac: Cmd + Shift + R

2. 브라우저 보안 정책 (CORS)
이 프로젝트는 ES Modules를 사용하므로 로컬 파일(file://)을 직접 더블 클릭하면 작동하지 않을 수 있습니다.

권장: VS Code의 Live Server 확장 프로그램을 사용하거나, GitHub Pages에 올려서 실행하세요.
